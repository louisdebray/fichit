Tu as raison — je te renvoie **le fichier complet** avec **tous** les boutons/éléments (navbar, badge plan, upgrade, logout, etc.) + le **bouton “Générer la fiche”**.
Le traitement se fait **en arrière-plan** et on **redirige tout de suite** vers le dashboard.

Colle ça tel quel dans `upload.html` :

```html
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>FichIt - Déposer un fichier</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="Uploader vos PDF pour générer des fiches de révision" name="description" />
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700&family=Rubik:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <style>
      :root { --accent:#ff385c; --accent-hover:#e33251; }
      body {
        font-family:'Plus Jakarta Sans', sans-serif;
        background: linear-gradient(135deg, #fff8f9 0%, #ffe3ea 100%);
      }
      /* Navbar compacte */
      .navbar { background:#fff; height:64px; display:flex; align-items:center; box-shadow:none; border:none !important; }
      .navbar-brand img { height:40px; display:block; margin-top:0; }
      .navbar .btn { padding:.45rem 1.2rem !important; font-size:.95rem; }
      /* Badge plan */
      .plan-badge{
        display:inline-flex; align-items:center; gap:6px;
        border:1px solid var(--accent); color:var(--accent); background:#fff;
        padding:4px 10px; border-radius:999px; font-size:.85rem; font-weight:700;
        line-height:1;
      }
      .plan-badge.premium{ background:var(--accent); color:#fff; border-color:var(--accent); }
      .plan-dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); display:inline-block; }
      .plan-badge.premium .plan-dot{ background:#fff; }
      /* Section upload */
      .upload-section { min-height: calc(100vh - 120px); display:flex; align-items:center; justify-content:center; }
      .upload-box {
        background:#fff; border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.08);
        padding:3rem; max-width:520px; width:100%; text-align:center;
      }
      .upload-box h2 { color:var(--accent); font-weight:700; margin-bottom:1.2rem; }
      .actions { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
      .btn-pill { border:none; border-radius:999px; padding:.75rem 1.4rem; font-size:1.05rem; font-weight:600; cursor:pointer; transition:all .2s ease; }
      .btn-choose { background-color:#f1f3f5; color:#333; }
      .btn-choose:hover { background-color:#e9ecef; }
      .btn-generate { background-color:var(--accent); color:#fff; }
      .btn-generate:hover { background-color:var(--accent-hover); }
      .btn-generate:disabled { opacity:.6; cursor:not-allowed; }
      .file-input { display:none; }
      .file-meta { margin-top:.75rem; color:#555; font-size:.95rem; }
      .change-file { font-size:.9rem; margin-top:.25rem; }
      .change-file button { background:none; border:none; color:var(--accent); text-decoration:underline; cursor:pointer; padding:0; }
      .upload-info { margin-top:1rem; color:#666; font-size:.9rem; }
      .footer { background:#fff; border-top:1px solid #eee; }
      /* Spinner full-screen */
      #spinner {
        position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
        background:#fff; opacity:0; visibility:hidden; transition:opacity .3s ease; z-index:9999;
      }
      #spinner.show { opacity:1; visibility:visible; }
      /* Status */
      #uploadStatus.small { font-size:.9rem; }
    </style>
  </head>
  <body>
    <!-- Spinner -->
    <div id="spinner">
      <div class="spinner-border text-primary" style="width:3rem;height:3rem" role="status"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top navbar-light px-4">
      <a href="index.html" class="navbar-brand p-0">
        <img src="img/logo.png" alt="FichIt Logo">
      </a>
      <div class="ms-auto d-flex align-items-center gap-3 flex-wrap">
        <span id="userName" class="text-dark fw-semibold d-none d-md-inline"></span>
        <span id="planBadge" class="plan-badge">
          <span class="plan-dot"></span>
          <span id="planBadgeText">Gratuit</span>
        </span>
        <a id="upgradeBtn" class="btn btn-outline-primary rounded-pill py-2 px-3 d-none" href="https://buy.stripe.com/bJedRb2Y65wS0RDgbA1Nu00" rel="noopener">Mettre à niveau</a>
        <div id="navButtons"></div>
      </div>
    </nav>

    <!-- Upload Section -->
    <div class="container upload-section">
      <div class="upload-box">
        <h2>Déposez votre fichier</h2>
        <p class="mb-3 text-muted">Générez votre fiche de révision en quelques secondes.</p>

        <input type="file" id="fileInput" class="file-input" accept="application/pdf" />
        <div class="actions mb-2">
          <button class="btn-pill btn-choose" id="uploadBtn"><i class="fas fa-file-upload me-2"></i> Choisir un fichier</button>
          <button class="btn-pill btn-generate" id="generateBtn" disabled><i class="fas fa-magic me-2"></i> Générer la fiche</button>
        </div>

        <div class="file-meta" id="fileInfo">Format pris en charge : PDF</div>
        <div class="change-file d-none" id="changeFile"><button type="button" id="changeFileBtn">Changer de fichier</button></div>

        <div id="uploadStatus" class="mt-2 text-success fw-semibold small"></div>
      </div>
    </div>

    <!-- Footer -->
    <div class="container-fluid footer py-4 mt-5">
      <div class="container text-center">
        <small class="text-muted">© 2025 FichIt – Tous droits réservés.</small>
      </div>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase + Auth + Upload -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
      import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

      // ✅ Config avec storageBucket pour éviter l'erreur Storage
      const firebaseConfig = {
        apiKey:"AIzaSyCUYgbDvFb4FjaMrsL-2-wVjlME5iODVOs",
        authDomain:"fichit-64628.firebaseapp.com",
        projectId:"fichit-64628",
        storageBucket:"fichit-64628.appspot.com"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const storage = getStorage(app);
      const db = getFirestore(app);

      const spinner = document.getElementById('spinner');
      const navButtons = document.getElementById('navButtons');
      const userNameEl = document.getElementById('userName');
      const planBadge = document.getElementById('planBadge');
      const planBadgeText = document.getElementById('planBadgeText');
      const upgradeBtn = document.getElementById('upgradeBtn');

      const uploadBtn = document.getElementById('uploadBtn');
      const generateBtn = document.getElementById('generateBtn');
      const fileInput = document.getElementById('fileInput');
      const fileInfo = document.getElementById('fileInfo');
      const changeFile = document.getElementById('changeFile');
      const changeFileBtn = document.getElementById('changeFileBtn');
      const uploadStatus = document.getElementById('uploadStatus');

      let selectedFile = null;

      // UI: badge plan
      function setPlanBadgeUI({ isPremium }) {
        if (isPremium) {
          planBadge.classList.add('premium');
          planBadgeText.textContent = 'Premium';
          upgradeBtn.classList.add('d-none');
        } else {
          planBadge.classList.remove('premium');
          planBadgeText.textContent = 'Gratuit';
          upgradeBtn.classList.remove('d-none');
        }
      }
      async function updateBadgeFromClaims(user, force=false) {
        try {
          const tokenResult = await user.getIdTokenResult(force);
          const isPremium = !!tokenResult.claims?.premium;
          setPlanBadgeUI({ isPremium });
          return isPremium;
        } catch {
          setPlanBadgeUI({ isPremium:false });
          return false;
        }
      }

      // Auth + navbar
      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          window.location.href = "login.html?tab=login";
          return;
        }
        const name = user.displayName || user.email || "Utilisateur";
        userNameEl.textContent = name;
        userNameEl.classList.remove('d-none');
        navButtons.innerHTML = `
          <a href="dashboard.html" class="btn btn-primary rounded-pill py-2 px-4 me-2">Mon tableau de bord</a>
          <button id="logoutBtn" class="btn btn-outline-danger rounded-pill py-2 px-3">Se déconnecter</button>
        `;
        const logoutBtn = document.getElementById("logoutBtn");
        logoutBtn.addEventListener("click", () => {
          logoutBtn.disabled = true;
          logoutBtn.textContent = "Déconnexion...";
          signOut(auth).finally(() => window.location.href = "login.html?tab=login");
        });

        let hasPremium = await updateBadgeFromClaims(user, false);
        if (!hasPremium) { hasPremium = await updateBadgeFromClaims(user, true); }
        if (!hasPremium) {
          let tries = 0;
          const iv = setInterval(async () => {
            tries++;
            const ok = await updateBadgeFromClaims(user, true);
            if (ok || tries >= 10) clearInterval(iv);
          }, 3000);
        }
      });

      // Choisir / changer de fichier
      uploadBtn.addEventListener('click', () => fileInput.click());
      changeFileBtn.addEventListener('click', () => fileInput.click());

      fileInput.addEventListener('change', () => {
        const file = fileInput.files[0];
        uploadStatus.textContent = "";
        uploadStatus.classList.remove("text-danger");
        uploadStatus.classList.add("text-success");

        if (!file) {
          selectedFile = null;
          fileInfo.textContent = "Format pris en charge : PDF";
          changeFile.classList.add('d-none');
          generateBtn.disabled = true;
          return;
        }
        if (file.type !== "application/pdf") {
          selectedFile = null;
          fileInfo.textContent = "Format pris en charge : PDF";
          changeFile.classList.add('d-none');
          generateBtn.disabled = true;
          uploadStatus.textContent = "Veuillez sélectionner un fichier PDF.";
          uploadStatus.classList.replace("text-success", "text-danger");
          return;
        }

        selectedFile = file;
        fileInfo.textContent = `Fichier sélectionné : ${file.name} (${Math.round(file.size/1024)} Ko)`;
        changeFile.classList.remove('d-none');
        generateBtn.disabled = false;
      });

      // Générer (upload + appel API en arrière-plan + redirection immédiate)
      generateBtn.addEventListener('click', async () => {
        if (!selectedFile) return;

        // Lock UI
        generateBtn.disabled = true;
        uploadBtn.disabled = true;
        spinner.classList.add('show');
        uploadStatus.textContent = "Upload en cours...";
        uploadStatus.classList.remove("text-danger");
        uploadStatus.classList.add("text-success");

        try {
          // 1) Upload vers Firebase Storage
          const storageRef = ref(storage, `uploads/${auth.currentUser.uid}/${Date.now()}_${selectedFile.name}`);
          const uploadTask = uploadBytesResumable(storageRef, selectedFile);

          await new Promise((resolve, reject) => {
            uploadTask.on(
              'state_changed',
              (snap) => {
                const p = (snap.bytesTransferred / snap.totalBytes) * 100;
                uploadStatus.textContent = `Upload en cours... (${Math.round(p)}%)`;
              },
              (err) => reject(new Error("Erreur lors de l'upload : " + err.message)),
              () => resolve()
            );
          });

          const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);

          // 2) Appel API NON bloquant (fire-and-forget)
          fetch('https://fichit-api.vercel.app/api/generate-fiche', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pdfUrl: downloadURL, userId: auth.currentUser.uid }),
          }).catch(() => { /* on ignore les erreurs pour ne pas bloquer l'UX */ });

          // 3) Redirection immédiate vers le dashboard
          spinner.classList.remove('show');
          window.location.href = 'dashboard.html';
        } catch (error) {
          uploadStatus.textContent = error.message;
          uploadStatus.classList.replace("text-success", "text-danger");
          spinner.classList.remove('show');
          generateBtn.disabled = false;
          uploadBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
```

Si tu veux, je peux ensuite ajouter sur le **dashboard** une pastille “En cours de génération…” + un auto-refresh léger pour afficher la fiche dès qu’elle est prête.
